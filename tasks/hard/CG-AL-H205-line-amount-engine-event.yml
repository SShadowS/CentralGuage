id: CG-AL-H205
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  Create a codeunit called "CG Line Amount Engine" with ID 70205.
  The codeunit must have Access = Public.

  Implement this procedure:
  CalculateLineAmount(UnitPrice: Decimal; Quantity: Decimal; DiscountPercent: Decimal; RoundingPrecision: Decimal): Decimal

  Rules:
  - If any of UnitPrice, Quantity, DiscountPercent, or RoundingPrecision is < 0 then error text must be exactly: "Inputs cannot be negative"
  - If RoundingPrecision = 0 then error text must be exactly: "Rounding precision must be greater than zero"
  - If UnitPrice = 0 OR Quantity = 0 then return 0 (no error)
  - If DiscountPercent > 100 then treat it as 100
  - Gross = UnitPrice * Quantity
  - DiscountAmount = Round(Gross * (DiscountPercent / 100), RoundingPrecision, '=')
  - Net = Gross - DiscountAmount
  - Return Round(Net, RoundingPrecision, '=')

  Add an IntegrationEvent with this exact signature:
  OnAfterCalculateLineAmount(var Result: Decimal; UnitPrice: Decimal; Quantity: Decimal; DiscountPercent: Decimal; RoundingPrecision: Decimal)

  The event must be raised for every call to CalculateLineAmount where no error is thrown.
expected:
  compile: true
  testApp: tests/al/hard/CG-AL-H205.Test.al
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
