id: CG-AL-H022
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  Create a codeunit named "CG Dynamic Record Handler" with ID 70224 that demonstrates
  advanced RecordRef and FieldRef usage for dynamic record manipulation.

  1. Procedure "GetTableName" that takes Integer parameter TableId and returns Text.
     Open the table by ID using RecordRef.Open(), return the table name using RecordRef.Name.
     Return empty string if the table cannot be opened (invalid ID).
     Always close the RecordRef when done.

  2. Procedure "GetPrimaryKeyFieldCount" that takes Integer parameter TableId and returns Integer.
     Open the table, get the primary key using KeyIndex(1), return FieldCount of that key.
     Return 0 if the table has no keys (KeyCount = 0) or cannot be opened.
     Always close the RecordRef when done.

  3. Procedure "GetFieldValueAsText" that takes var RecordRef parameter RecRef and
     Integer parameter FieldNo, returns Text.
     Check if field exists using FieldExist(). If not, return empty string.
     If field exists, get FieldRef and return Format(FieldRef.Value).

  4. Procedure "SetFieldValue" that takes var RecordRef parameter RecRef,
     Integer parameter FieldNo, and Variant parameter NewValue. Returns Boolean.
     Check if field exists. If not, return false.
     If field exists, set FieldRef.Value to NewValue and return true.

  5. Procedure "CopyMatchingFields" that takes RecordRef parameter SourceRecRef and
     var RecordRef parameter DestRecRef. Returns Integer (count of fields copied).
     Iterate through fields in SourceRecRef. For each field, check if DestRecRef has
     a field with the same Name. If so, copy the value. Return total count of copied fields.
     Use FieldIndex to iterate fields from 1 to FieldCount.

  6. Procedure "GetFilterString" that takes var RecordRef parameter RecRef and returns Text.
     Return RecRef.GetFilters() which returns the current filter string.

  7. Procedure "ApplyFilterString" that takes var RecordRef parameter RecRef and
     Text parameter FilterText. Returns Boolean.
     Apply the filter using RecRef.SetView(FilterText).
     Return true if successful, false if an error occurs.

  8. Procedure "GetRelatedTableId" that takes Integer parameter TableId and
     Integer parameter FieldNo. Returns Integer.
     Open the table, check if field exists, get the FieldRef.Relation property.
     Return the related table ID, or 0 if no relation exists or field not found.
     Always close the RecordRef when done.

  Include Access = Public on the codeunit.
expected:
  compile: true
  testApp: tests/al/hard/CG-AL-H022.Test.al
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
