id: CG-AL-H016
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  Create an AL codeunit named "CG Secure Storage" with ID 70016 that demonstrates SecretText handling:

  1. Procedure "StoreApiKey" that takes a SecretText parameter named ApiKey and stores it
     in IsolatedStorage using DataScope::Module. Use key 'CG_API_KEY'. Does not return anything.

  2. Procedure "RetrieveApiKey" that retrieves the stored key from IsolatedStorage
     and returns it as SecretText.

  3. Procedure "BuildAuthHeader" that takes apiKey as SecretText, returns Text containing
     'Bearer ' prefix concatenated with the unwrapped secret value.

  4. Procedure "ValidateCredentials" that takes username Text and password SecretText,
     returns Boolean. Return false if username is empty. For password, unwrap and check not empty.

  5. Procedure "MaskSecret" that takes a SecretText named Secret and returns a masked Text
     showing only first 4 characters followed by '****'. Handle short secrets appropriately.

expected:
  compile: true
  testApp: tests/al/hard/CG-AL-H016.Test.al
  testCodeunitId: 80017
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
