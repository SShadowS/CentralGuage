id: CG-AL-H003
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  Create a codeunit called "CG Temp Table Processor" with ID 70202 that demonstrates correct temporary table handling.

  Implement procedure:
  ProcessItemsWithDiscount(var TempResult: Record "CG Discount Result" temporary; MinDiscount: Decimal)

  The "CG Discount Result" table (ID 70203) must also be created with fields:
  - "Line No." (Integer, primary key)
  - "Item No." (Code[20])
  - "Original Price" (Decimal)
  - "Discount Percent" (Decimal)
  - "Final Price" (Decimal)

  The procedure must:
  1. Clear the TempResult table completely before processing
  2. Loop through the Item table (standard BC table)
  3. For each item where "Unit Price" > 0, calculate a discount based on inventory:
     - If Item.Inventory >= 100: Discount = 15%
     - If Item.Inventory >= 50: Discount = 10%
     - If Item.Inventory >= 10: Discount = 5%
     - Otherwise: Discount = 0%
  4. Only add items to TempResult where calculated discount >= MinDiscount
  5. Set "Final Price" = "Unit Price" * (1 - Discount/100), rounded to 2 decimals

  The codeunit must have Access = Public.
  Critical: The TempResult parameter must be marked as "temporary" in the procedure signature.
expected:
  compile: true
  testApp: tests/al/hard/CG-AL-H003.Test.al
  testCodeunitId: 80003
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
