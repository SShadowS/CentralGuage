id: CG-AL-M112
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  Create two tables:

  1) Table "CG Project" with ID 70112
  Table properties:
  - Caption = 'CG Project'
  - DataClassification = CustomerContent

  Fields:
  1. No. (Code[20], primary key, NotBlank = true)
  2. Description (Text[100])
  3. Billable (Boolean, InitValue = true)
  4. Total Posted Hours (Decimal, FlowField)
  5. Total Open Hours (Decimal, FlowField)

  Keys:
  - PK on No., Clustered = true

  FlowField formulas:
  - Total Posted Hours must be the SUM of "CG Time Entry".Hours where Project No. = field(No.) and Posted = const(true)
  - Total Open Hours must be the SUM of "CG Time Entry".Hours where Project No. = field(No.) and Posted = const(false)

  Trigger:
  - OnDelete: If any "CG Time Entry" exists for the project (any Posted value), block deletion.
    Error text must be exactly: "Cannot delete project with time entries"

  2) Table "CG Time Entry" with ID 70113
  Table properties:
  - Caption = 'CG Time Entry'
  - DataClassification = CustomerContent

  Fields:
  1. Entry No. (Integer, primary key, AutoIncrement = true)
  2. Project No. (Code[20], NotBlank = true, TableRelation to "CG Project"."No.")
  3. Entry Date (Date)
  4. Hours (Decimal)
  5. Posted (Boolean, InitValue = false)

  Keys:
  - PK on Entry No., Clustered = true

  Behavior:
  - Hours OnValidate: if Hours <= 0 then error. Error text must be exactly: "Hours must be greater than zero"
  - OnInsert trigger: if Entry Date is 0D then set it to WorkDate()
expected:
  compile: true
  testApp: tests/al/medium/CG-AL-M112.Test.al
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
