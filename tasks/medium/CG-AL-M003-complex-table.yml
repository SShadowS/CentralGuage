id: CG-AL-M003
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  Create a complex table called "Sales Contract" with ID 70002 that includes comprehensive validation.
  Fields should include:
  - Contract No. (Code[20], primary key, auto-generated)
  - Customer No. (Code[20], with TableRelation to Customer)
  - Start Date and End Date (Date fields with validation)
  - Contract Value (Decimal with minimum value validation)
  - Status (Option: Draft, Active, Suspended, Terminated, Closed)
  - Payment Terms (Code[10] with TableRelation)

  Include complex validation in triggers:
  - OnValidate for End Date: Must validate that End Date is after Start Date.
    Error message must be exactly: "End Date must be after Start Date"
  - OnValidate for Contract Value: Must be positive (greater than 0).
    Error message must be exactly: "Contract Value must be positive"
  - OnInsert trigger to:
    * Auto-generate Contract No. if not already set
    * Set default Status to Draft
  - OnDelete trigger to prevent deletion of Active contracts.
    Error message must be exactly: "Cannot delete active contract"

  Include proper captions, data classification, and field validation patterns.
expected:
  compile: true
  testApp: tests/al/medium/CG-AL-M003.Test.al
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
