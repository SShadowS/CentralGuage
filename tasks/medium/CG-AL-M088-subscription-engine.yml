id: CG-AL-M088
prompt_template: code-gen.md
fix_template: bugfix.md
max_attempts: 2
description: >-
  1. Create an Enum with ID 70188 named "Subscription Plan".
     Values: Basic, Premium, Enterprise.

  2. Create a Codeunit with ID 70188 named "Subscription Engine".

  3. Implement a procedure:
     GetNextBillingDate(LastBillingDate: Date; Plan: Enum "Subscription Plan"): Date

  Logic:
  - Basic: Adds 1 Month.
  - Premium: Adds 3 Months.
  - Enterprise: Adds 1 Year.
  - If the LastBillingDate is empty (0D), use WorkDate() as the starting point.

  4. Implement a procedure:
     CalculateProratedRefund(TotalAmount: Decimal; DaysUsed: Integer; Plan: Enum "Subscription Plan"): Decimal

  Logic:
  - If DaysUsed is negative, return 0.
  - Total days in period depends on Plan (Basic=30, Premium=90, Enterprise=365).
  - Formula: (TotalAmount / Total Days) * (Total Days - DaysUsed).
  - Round the result to 2 decimal places.
expected:
  compile: true
  testApp: tests/al/medium/CG-AL-M088.Test.al
metrics:
  - compile_pass
  - tests_pass
  - pass_attempt
